"use strict";(self.webpackChunkchimera_docs_use=self.webpackChunkchimera_docs_use||[]).push([[7226],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>u});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),l=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},d=function(e){var t=l(e.components);return n.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,d=c(e,["components","mdxType","originalType","parentName"]),h=l(a),u=i,m=h["".concat(s,".").concat(u)]||h[u]||p[u]||r;return a?n.createElement(m,o(o({ref:t},d),{},{components:a})):n.createElement(m,o({ref:t},d))}));function u(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=h;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:i,o[1]=c;for(var l=2;l<r;l++)o[l]=a[l];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},3022:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>c,toc:()=>l});var n=a(7462),i=(a(7294),a(3905));const r={sidebar_position:2},o="Performance",c={unversionedId:"Advanced topics/Performance",id:"Advanced topics/Performance",title:"Performance",description:"Caching",source:"@site/docs/developer/Advanced topics/Performance.md",sourceDirName:"Advanced topics",slug:"/Advanced topics/Performance",permalink:"/chimera-docs/docs/developer/Advanced topics/Performance",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"docsSidebar",previous:{title:"Under the hood",permalink:"/chimera-docs/docs/developer/Advanced topics/Under the hood"},next:{title:"Localization",permalink:"/chimera-docs/docs/developer/Advanced topics/Localization"}},s={},l=[{value:"Caching",id:"caching",level:2},{value:"chimera:cache-indicators",id:"chimeracache-indicators",level:3},{value:"chimera:cache-scorecards",id:"chimeracache-scorecards",level:3},{value:"Cache clearing",id:"cache-clearing",level:2},{value:"Cached data time stamp",id:"cached-data-time-stamp",level:2}],d={toc:l};function p(e){let{components:t,...r}=e;return(0,i.kt)("wrapper",(0,n.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"performance"},"Performance"),(0,i.kt)("h2",{id:"caching"},"Caching"),(0,i.kt)("p",null,"The Dashboard Starter Kit comes with a complete caching strategy built-in."),(0,i.kt)("p",null,"Caching is not enabled by default and to enable it, you must set CACHE_ENABLED to ",(0,i.kt)("em",{parentName:"p"},"true")," in your .env file as documented in the ",(0,i.kt)("a",{parentName:"p",href:"/docs/developer/getting-started/configuration#dashboard-features"},"Configuration")," section."),(0,i.kt)("p",null,"Once caching is enabled, every published indicator, scorecard, case stat and map indicator will be cached for a set amount of time that is determined by the CACHE_TTL_SECONDS setting in your .env file. The default value of the caching time is ",(0,i.kt)("strong",{parentName:"p"},"one hour"),"."),(0,i.kt)("p",null,"You will most likely want to use your own caching strategy that is appropriate to your data size and other needs. You will therefore need to schedule tasks to update these caches regularly. This is achieved by using the ",(0,i.kt)("inlineCode",{parentName:"p"},"chimera:cache")," group of commands. You can run them manually as such but you should schedule them using Laravel's scheduled tasks."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"php artisan chimera:cache-indicators\nphp artisan chimera:cache-scorecards\nphp artisan chimera:cache-mapindicators\n")),(0,i.kt)("h3",{id:"chimeracache-indicators"},"chimera:cache-indicators"),(0,i.kt)("p",null,"The command has three options which you can use to control how caching happens"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("em",{parentName:"p"},"max-level")," : this option, when passed, will control the level depth of caching that will occur for indicators. By default, only national and first area levels will be cached. Accepts a number between 1 and the total number of area hierarchies you have")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("em",{parentName:"p"},"questionnaire")," : this option can be used to update the cache of indicators that belong to that specific questionnaire. By default, indicators across all questionnaires will be updated")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("em",{parentName:"p"},"tag")," : this option, when passed, will specifically target indicators that have been assigned the given tag, excluding all other untagged indicators"))),(0,i.kt)("p",null,"Example: the first command would update all indicators (published and untagged), the second will update all indicators (published and untagged) within the enumeration questionnaire and the third one will update indicators that have the 'priority' tag"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"php artisan chimera:cache-indicators\nphp artisan chimera:cache-indicators --questionnaire=enumeration\nphp artisan chimera:cache-indicators --tag=priority\n")),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"You can manage the tag list by editing the tags key under the cache chimera config"),(0,i.kt)("p",{parentName:"admonition"},"Example (in file config\\chimera.php):"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-php"},"'cache' => [\n    'enabled' => env('CACHE_ENABLED', false),\n    'ttl' => env('CACHE_TTL_SECONDS', 60 * 60),\n    'tags' => ['priority', 'secondary'],\n],\n")),(0,i.kt)("p",{parentName:"admonition"},"then, when editing indicators you will see a dropdown named 'Cache Tags' which you can use to assign one of the tags you have set in the chimera config to each of your indicators. By default, indicators will have no assigned tag and you do not need to assign tags for indicators you\ndo not want to target specifically. ")),(0,i.kt)("h3",{id:"chimeracache-scorecards"},"chimera:cache-scorecards"),(0,i.kt)("p",null,"The command has two options which you can include to control how caching happens"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"questionnaire")," : this option can be used to update the cache of scorecards that belong to that specific questionnaire. By default, scorecards across all questionnaires will be updated")),(0,i.kt)("p",null,"As it is not practical to update the cache manually on the command line, you will need to schedule the chimera:cache artisan command.\nFor details, please refer to the ",(0,i.kt)("a",{parentName:"p",href:"https://laravel.com/docs/9.x/scheduling#scheduling-artisan-commands"},"Task Scheduling")," section of the Laravel documentation."),(0,i.kt)("p",null,"Basically, you add the following type of code to the schedule() method of your ",(0,i.kt)("inlineCode",{parentName:"p"},"App\\Console\\Kernel")," class file"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"$schedule->command('chimera:cache --questionnaire=enumeration')->everySixHours();\n")),(0,i.kt)("h2",{id:"cache-clearing"},"Cache clearing"),(0,i.kt)("p",null,"If, for some reason, you need to clear cached data, you can use the ",(0,i.kt)("inlineCode",{parentName:"p"},"chimera:cache-clear")," command. It has two options"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("em",{parentName:"p"},"questionnaire")," : this option can be used to clear the cache of all items stored under the given questionnaire")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("em",{parentName:"p"},"type")," : this option can be used to clear specific types of cached data. Possible values for this option are: ",(0,i.kt)("em",{parentName:"p"},"indicators, scorecards, casestats or mapindicators")))),(0,i.kt)("admonition",{type:"danger"},(0,i.kt)("p",{parentName:"admonition"},"Executing the cache-clear command without any options will clear the cache of everything! It will remove all entries from the cache. Consider this carefully before executing the command.")),(0,i.kt)("h2",{id:"cached-data-time-stamp"},"Cached data time stamp"),(0,i.kt)("p",null,"When caching is enabled, a small, faded rubber stamp icon will appear somewhere over each indicator, scorecard and case stats table."),(0,i.kt)("p",null,"When hovered over, it will display the time the data being displayed was cached at."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Cache time stamp display",src:a(7231).Z,width:"1000",height:"335"})))}p.isMDXComponent=!0},7231:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/cache-timestamp-icon-3534a57371bebae53549a72bd486327e.png"}}]);